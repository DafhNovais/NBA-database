CREATE DATABASE nba;

USE nba;

CREATE TABLE GAMES (
	GAME_ID INT PRIMARY KEY,
	GAME_DATE_EST DATE,
    HOME_TEAM_ID INT,
	VISITOR_TEAM_ID INT, 
    SEASON DATE,
    TEAM_ID_home INT,
    PTS_home INT,
    AST_home INT,
	REB_home INT,
	TEAM_ID_away INT,
	PTS_away INT,
	AST_away INT,
	REB_away INT,
	HOME_TEAM_WINS INT
);

CREATE TABLE GAMES_DETAILS (
	GAME_ID INT,
	TEAM_ID INT,
	TEAM_ABBREVIATION CHAR(3),
	TEAM_CITY VARCHAR(15),
	PLAYER_ID INT,
	START_POSITION CHAR(1),
	COMENT VARCHAR(50),
	MIN TIMESTAMP,
	FGM INT,
	FGA INT,
	FG3M INT,
	FTA INT,
	OREB INT,
	DREB INT,
	REB INT,
	AST INT,
	STL INT,
	BLK INT,
	TOO INT,
	PF INT,
	PTS INT,
	PLUS_MINUS INT
);

CREATE TABLE PLAYERS (
	PLAYER_ID INT PRIMARY KEY,
	PLAYER_NAME VARCHAR(50) DEFAULT '' not null,
	TEAM_ID INT,
	SEASON datetime
);

CREATE TABLE RANKING (
	TEAM_ID INT,
	SEASON_ID INT,
	STANDINGSDATE DATETIME,
	CONFERENCE CHAR(5),
	G INT,
	W INT,
	L INT,
	W_PCT DECIMAL,
	HOME_RECORD VARCHAR(6),
	ROAD_RECORD VARCHAR(6)
  );
  
CREATE TABLE TEAMS (
	TEAM_ID INT PRIMARY KEY,
    TEAM VARCHAR(20),
	MIN_YEAR DATE,
	MAX_YEAR DATE,
	ABBREVIATION CHAR(3),
	NICKNAME VARCHAR(12),
	YEARFOUNDED DATE,
	CITY VARCHAR(20),
	ARENA VARCHAR(30),
	ARENACAPACITY VARCHAR(6),
	OWNERR VARCHAR(40),
	GENERALMANAGER VARCHAR(40),
	HEADCOACH VARCHAR(40),
	DLEAGUEAFFILIATION VARCHAR(40)
  );
  
ALTER TABLE GAMES
    ADD CONSTRAINT GAMES_TEAMS_TEAM_ID_fk
	FOREIGN KEY (HOME_TEAM_ID) REFERENCES TEAMS (TEAM_ID);

ALTER TABLE GAMES
    ADD CONSTRAINT GAMES_TEAMS_TEAM_ID_fk_2
	FOREIGN KEY (VISITOR_TEAM_ID) REFERENCES TEAMS (TEAM_ID);

ALTER TABLE GAMES
    ADD CONSTRAINT GAMES_TEAMS_TEAM_ID_fk_3
	FOREIGN KEY (TEAM_ID_home) REFERENCES TEAMS (TEAM_ID);

ALTER TABLE GAMES
    ADD CONSTRAINT GAMES_TEAMS_TEAM_ID_fk_4
	FOREIGN KEY (TEAM_ID_away) REFERENCES TEAMS (TEAM_ID);

ALTER TABLE GAMES_DETAILS
    ADD CONSTRAINT GAMES_DETAILS___fk
	FOREIGN KEY (GAME_ID) REFERENCES GAMES (GAME_ID);

ALTER TABLE GAMES_DETAILS
    ADD CONSTRAINT GAMES_DETAILS___fk_2
	 FOREIGN KEY(TEAM_ID) REFERENCES TEAMS(TEAM_ID);

ALTER TABLE GAMES_DETAILS
    ADD CONSTRAINT GAMES_DETAILS___fk_3
	FOREIGN KEY(PLAYER_ID) REFERENCES PLAYERS(PLAYER_ID);
	
ALTER TABLE RANKING
    ADD CONSTRAINT RANKING_fk
	FOREIGN KEY(TEAM_ID) REFERENCES TEAMS(TEAM_ID)


-- Os 10 primeiros times que mais tiveram pontos em 2015:
SELECT T.NICKNAME, SEASON,  sum(PTS_home) FROM nba.GAMES
    JOIN TEAMS T ON GAMES.TEAM_ID_home = T.TEAM_ID
    WHERE SEASON = '2015'
    GROUP BY TEAM_ID_home, SEASON ORDER BY SUM(PTS_home) DESC ;

-- O time que mais teve ponto em 2016 em casa:
SELECT T.NICKNAME, SEASON,  sum(PTS_home) FROM nba.GAMES
    JOIN TEAMS T ON GAMES.TEAM_ID_home = T.TEAM_ID
    WHERE SEASON = '2016'
    GROUP BY TEAM_ID_home, SEASON ORDER BY SUM(PTS_home) DESC;

-- O time que mais teve ponto em 2017 em casa:
SELECT T.NICKNAME, SEASON, sum(PTS_home) FROM nba.GAMES
    JOIN TEAMS T ON GAMES.TEAM_ID_home = T.TEAM_ID
    WHERE SEASON = '2017'
    GROUP BY TEAM_ID_home, SEASON ORDER BY SUM(PTS_home) DESC;

-- O time que mais teve ponto em 2018 em casa:
SELECT T.NICKNAME, SEASON,  sum(PTS_home) FROM nba.GAMES
    JOIN TEAMS T ON GAMES.TEAM_ID_home = T.TEAM_ID
    WHERE SEASON = '2018'
    GROUP BY TEAM_ID_home, SEASON ORDER BY SUM(PTS_home) DESC;

-- O time que mais teve ponto em 2019 em casa:
SELECT T.NICKNAME,SEASON,  sum(PTS_home) FROM nba.GAMES
    JOIN TEAMS T ON GAMES.TEAM_ID_home = T.TEAM_ID
    where SEASON = '2019'
    GROUP BY TEAM_ID_home, SEASON ORDER BY SUM(PTS_home) DESC;


-- Total de jogos em cada ano em casa:
SELECT COUNT(SEASON), SEASON FROM GAMES WHERE SEASON = '2015';
SELECT COUNT(SEASON), SEASON FROM GAMES WHERE SEASON = '2016';
SELECT COUNT(SEASON), SEASON FROM GAMES WHERE SEASON = '2017';
SELECT COUNT(SEASON), SEASON FROM GAMES WHERE SEASON = '2018';
SELECT COUNT(SEASON), SEASON FROM GAMES WHERE SEASON = '2019';
